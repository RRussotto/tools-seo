<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SEO Performance Audit</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 2rem; background-color: #f9f9f9; color: #333; }
    input, select, button { padding: 0.6rem; margin: 0.5rem 0; width: 100%; max-width: 500px; }
    button { background-color: #007bff; color: white; border: none; cursor: pointer; }
    button:hover { background-color: #0056b3; }
    table { width: 100%; max-width: 800px; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 0.8rem; text-align: left; }
    th { background-color: #eee; }
    .status { padding: 0.3rem 0.6rem; border-radius: 4px; color: #fff; font-weight: bold; }
    .green { background-color: #28a745; }
    .yellow { background-color: #ffc107; color: #000; }
    .red { background-color: #dc3545; }
    .score { font-size: 1.5rem; margin-top: 1rem; }
  </style>
</head>
<body>
  <h1>SEO Performance Audit Tool</h1>
  <input type="text" id="url" placeholder="Inserisci l'URL da analizzare"/>
  <select id="strategy">
    <option value="mobile">Mobile</option>
    <option value="desktop">Desktop</option>
  </select>
  <button onclick="analizza()">Analizza</button>
  <div id="output"></div>

  <script>
    function getStatus(value, thresholds) {
      if (value <= thresholds.green) return "green";
      if (value <= thresholds.yellow) return "yellow";
      return "red";
    }

    async function analizza() {
      const url = document.getElementById('url').value;
      const strategy = document.getElementById('strategy').value;
      const res = await fetch(`/api/performance?url=${encodeURIComponent(url)}&strategy=${strategy}`);
      const data = await res.json();
      const audits = data.lighthouseResult.audits;

      const metrics = [
        { id: "first-contentful-paint", label: "First Contentful Paint (FCP)", unit: "s", thresholds: { green: 1.8, yellow: 3.0 } },
        { id: "largest-contentful-paint", label: "Largest Contentful Paint (LCP)", unit: "s", thresholds: { green: 2.5, yellow: 4.0 } },
        { id: "total-blocking-time", label: "Total Blocking Time (TBT)", unit: "ms", thresholds: { green: 200, yellow: 600 } },
        { id: "cumulative-layout-shift", label: "Cumulative Layout Shift (CLS)", unit: "", thresholds: { green: 0.1, yellow: 0.25 } },
        { id: "speed-index", label: "Speed Index", unit: "s", thresholds: { green: 3.4, yellow: 5.8 } },
        { id: "interactive", label: "Time to Interactive (TTI)", unit: "s", thresholds: { green: 3.8, yellow: 7.3 } }
      ];

      let table = "<table><thead><tr><th>Metrica</th><th>Valore</th><th>Valutazione</th></tr></thead><tbody>";

      metrics.forEach(metric => {
        let value = audits[metric.id].numericValue;
        let displayValue = metric.unit === "s" ? (value / 1000).toFixed(2) + " s" :
                           metric.unit === "ms" ? value.toFixed(0) + " ms" :
                           value.toFixed(2);
        const status = getStatus(metric.unit === "s" || metric.unit === "ms" ? value / 1000 : value, metric.thresholds);
        table += `<tr><td>${metric.label}</td><td>${displayValue}</td><td><span class="status ${status}">${status.toUpperCase()}</span></td></tr>`;
      });

      table += "</tbody></table>";

      const score = Math.round(data.lighthouseResult.categories.performance.score * 100);
      const scoreColor = score >= 90 ? "green" : score >= 50 ? "yellow" : "red";

      document.getElementById("output").innerHTML = `
        <div class="score">Punteggio ${strategy.charAt(0).toUpperCase() + strategy.slice(1)}: 
          <span class="status ${scoreColor}">${score}/100</span></div>${table}
      `;
    }
  </script>
</body>
</html>

